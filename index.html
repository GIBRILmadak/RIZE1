<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>RIZE | Tracez votre progression</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@400;600;700;800&display=swap"
            rel="stylesheet"
        />
        <!-- Web icon and branding -->
        <link rel="icon" type="image/svg+xml" href="icons/logo.png" />
        <link rel="shortcut icon" href="icons/logo.png" />
        <meta name="theme-color" content="#050505" />
        <meta
            name="description"
            content="RIZE - Plateforme de suivi de progression transparente sans dopamine sociale"
        />
        <!-- Styles globaux -->
        <link rel="stylesheet" href="css/style.css" />
        <link rel="stylesheet" href="css/search-notification.css" />
        <link rel="stylesheet" href="css/arcs.css" />
        <link rel="stylesheet" href="css/streaming-analytics.css" />
        <!-- Supabase JS -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    </head>
    <body>
        <!-- Container pour les notifications Toast -->
        <div id="toast-container"></div>

        <!-- Overlay Immersif -->
        <div id="immersive-overlay">
            <!-- Contenu injecté dynamiquement -->
        </div>

        <!-- Modale Réglages -->
        <div id="settings-modal">
            <div class="settings-container">
                <!-- Contenu injecté dynamiquement -->
            </div>
        </div>

        <!-- Modale Création -->
        <div id="create-modal">
            <div class="create-container">
                <!-- Contenu injecté dynamiquement -->
            </div>
        </div>

        <!-- Panneau de Notifications -->
        <div id="notification-panel" class="notification-panel">
            <div class="notification-panel-header">
                <h3 class="notification-panel-title">Notifications</h3>
                <span
                    class="notification-mark-all"
                    onclick="markAllNotificationsAsRead()"
                    >Tout marquer comme lu</span
                >
            </div>
            <div id="notification-list" class="notification-list">
                <!-- Notifications injectées dynamiquement -->
            </div>
        </div>

        <nav>
            <a
                class="logo"
                onclick="navigateTo('discover')"
                style="cursor: pointer"
            >
                <div class="logo-img">
                    <img src="icons/logo.png" alt="RIZE - Logo" />
                </div>
                <span>RIZE</span>
            </a>
            <div class="nav-links">
                <a onclick="navigateTo('discover')"> discover</a>
                <a onclick="handleProfileNavigation()" id="nav-profile"
                    >Ma Trajectoire</a
                >
                <!-- Bouton Notifications -->
                <div
                    class="notification-button"
                    onclick="toggleNotificationPanel()"
                    style="display: none"
                    id="notification-btn"
                >
                    <svg
                        class="notification-icon"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path
                            d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"
                        ></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    <span
                        id="notification-badge"
                        class="notification-badge"
                    ></span>
                </div>

                <a href="#" id="nav-auth">Connexion</a>
            </div>
        </nav>

        <!-- DISCOVER -->
        <section id="discover" class="page active">
            <div class="container">
                <div class="discover-header">
                    <h2>En mouvement</h2>

                    <!-- Filtre EUX / MOI -->
                    <div
                        class="discover-filter"
                        style="
                            display: flex;
                            gap: 1rem;
                            margin-top: 1rem;
                            margin-bottom: 1rem;
                        "
                    >
                        <button
                            class="filter-btn active"
                            data-filter="all"
                            onclick="toggleDiscoverFilter('all')"
                            style="
                                background: none;
                                border: none;
                                color: var(--text-primary);
                                opacity: 1;
                                font-weight: 600;
                                cursor: pointer;
                                padding-bottom: 0.25rem;
                                border-bottom: 2px solid var(--accent-color);
                            "
                        >
                            ALL
                        </button>
                        <button
                            class="filter-btn"
                            data-filter="following"
                            onclick="toggleDiscoverFilter('following')"
                            style="
                                background: none;
                                border: none;
                                color: var(--text-secondary);
                                opacity: 0.7;
                                font-weight: 500;
                                cursor: pointer;
                                padding-bottom: 0.25rem;
                                border-bottom: 2px solid transparent;
                            "
                        >
                            MOI
                        </button>
                    </div>

                    <p style="color: var(--text-secondary)">
                        Cliquez pour plonger dans une trajectoire.
                    </p>

                    <!-- Annonces officielles -->
                    <div
                        id="announcements-container"
                        class="announcements"
                    ></div>

                    <!-- Barre de recherche -->
                    <div class="search-container" style="margin-top: 2rem">
                        <div class="search-input-wrapper">
                            <svg
                                class="search-icon"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input
                                type="text"
                                id="search-input"
                                class="search-input"
                                placeholder=""
                            />
                        </div>
                        <div id="search-results" class="search-results">
                            <!-- Résultats injectés dynamiquement -->
                        </div>
                    </div>
                </div>

                <div class="discover-grid">
                    <!-- Contenu injecté dynamiquement -->
                </div>
            </div>
        </section>

        <!-- BOUTON RÉGLAGES (FIXED POSITION) -->
        <div id="settings-button-container"></div>
        <!-- Bouton flottant pour publier une trace -->
        <div id="floating-create-container">
            <button id="floating-create-btn" class="btn-add" title="Publier une trace">
                <img src="icons/plus.svg" alt="Publier">
                <span>Publier</span>
            </button>
        </div>

        <!-- Configuration Supabase -->
        <script src="js/supabase-config.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <script src="js/analytics.js"></script>
        <!-- Améliorations UX -->
        <script src="js/ux-enhancements.js"></script>
        <script src="js/app-enhancements.js"></script>
        <!-- Modules de fonctionnalités -->
        <script src="js/search.js"></script>
        <script src="js/notifications.js"></script>
        <script src="js/file-upload.js"></script>
        <script src="js/arcs.js"></script>
        <!-- Script principal avec intégration Supabase -->
        <script src="js/app-supabase.js"></script>

        <script>
            // Initialiser les fonctionnalités au chargement
            document.addEventListener("DOMContentLoaded", function () {
                // Initialiser la recherche
                initializeSearch();

                // Initialiser les notifications si l'utilisateur est connecté
                if (currentUser) {
                    initializeNotifications();
                    document.getElementById("notification-btn").style.display =
                        "flex";
                }

                // Bouton flottant de publication
                const floatingBtn = document.getElementById(
                    "floating-create-btn",
                );
                if (floatingBtn) {
                    floatingBtn.addEventListener("click", () => {
                        if (!window.currentUser) {
                            alert("Connectez-vous pour publier une trace.");
                            return;
                        }
                        if (typeof window.openCreateMenu === "function") {
                            window.openCreateMenu(window.currentUser.id);
                        }
                    });
                }
            });
        </script>
    </body>
</html>
